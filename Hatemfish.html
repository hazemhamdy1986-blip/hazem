<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¹Ø§Ù„Ù… Ø­Ø§Ø²Ù… Ø§Ù„Ù…ÙØªÙˆØ­ - Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #001b33; touch-action: none; }
        canvas { display: block; }
    </style>
</head>
<body>
<script>
    // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ± Ø§Ù„Ø´ÙØ§ÙØ©
    const ASSETS = {
        player: 'https://raw.githubusercontent.com/Al-Ameen-Developer/Fish-Assets/main/real_fish_transparent.png',
        food: 'https://cdn-icons-png.flaticon.com/512/2271/2271068.png',
        enemy: 'https://cdn-icons-png.flaticon.com/512/2970/2970034.png',
        shark: 'https://cdn-icons-png.flaticon.com/512/1994/1994351.png'
    };

    const WORLD_SIZE = 4000;
    let player, foods, score = 0, level = 1;
    let playerName = "Ø­Ø§Ø²Ù…";

    class MainScene extends Phaser.Scene {
        constructor() { super('MainScene'); }

        preload() {
            this.load.image('fish', ASSETS.player);
            this.load.image('food', ASSETS.food);
            this.load.image('enemy', ASSETS.enemy);
            this.load.image('shark', ASSETS.shark);
        }

        create() {
            // 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ø§Ù„Ù… ÙˆØ§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            this.cameras.main.setBounds(0, 0, WORLD_SIZE, WORLD_SIZE);
            this.physics.world.setBounds(0, 0, WORLD_SIZE, WORLD_SIZE);

            // 2. Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø­Ø§Ø²Ù…) - Ø­Ø¬Ù… Ø£ØµØºØ± Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
            player = this.physics.add.sprite(WORLD_SIZE/2, WORLD_SIZE/2, 'fish');
            player.setScale(0.12); 
            player.setCollideWorldBounds(true);
            
            // Ø§Ù„Ø§Ø³Ù… ÙÙˆÙ‚ Ø§Ù„Ø³Ù…ÙƒØ© (Ø®Ø· Ø£ØµØºØ± Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„)
            this.playerLabel = this.add.text(0, 0, `${playerName} [Lv.${level}]`, { 
                fontSize: '14px', fill: '#fff', backgroundColor: '#00000066', padding: {x:4, y:2} 
            }).setOrigin(0.5, 2.8);

            this.cameras.main.startFollow(player, true, 0.1, 0.1);

            // 3. Ø§Ù„Ø·Ø¹Ø§Ù… ÙˆØ§Ù„Ù‚Ø±Ø´
            foods = this.physics.add.group();
            for(let i=0; i<100; i++) this.spawnFood();

            // 4. Ø§Ù„ØªØµØ§Ø¯Ù…Ø§Øª
            this.physics.add.overlap(player, foods, this.eatFood, null, this);

            // 5. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
            this.createMobileUI();
        }

        update() {
            // Ø­Ø±ÙƒØ© Ø°ÙƒÙŠØ© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„: Ø§Ù„Ø³Ù…ÙƒØ© ØªØªØ­Ø±Ùƒ ÙÙŠ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù„Ù…Ø³
            if (this.input.activePointer.isDown) {
                this.physics.moveToObject(player, this.input.activePointer.worldX, this.input.activePointer.worldY, 200);
                let angle = Phaser.Math.Angle.Between(player.x, player.y, this.input.activePointer.worldX, this.input.activePointer.worldY);
                player.setRotation(angle);
            } else {
                player.setVelocity(0);
            }

            this.playerLabel.setPosition(player.x, player.y);
            this.updateMiniMap();
        }

        spawnFood() {
            let f = foods.create(Phaser.Math.Between(100, WORLD_SIZE-100), Phaser.Math.Between(100, WORLD_SIZE-100), 'food');
            f.setScale(0.03);
        }

        eatFood(player, food) {
            food.destroy();
            score += 10;
            if(score % 50 === 0) { 
                level++; 
                player.setScale(player.scaleX + 0.005);
                this.playerLabel.setText(`${playerName} [Lv.${level}]`);
            }
            this.scoreText.setText(`ğŸ† ${score} | Lv.${level}`);
            this.spawnFood();
        }

        createMobileUI() {
            // Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø§Ù„Ù†Ù‚Ø§Ø·) - Ù…ÙƒØ§Ù† Ø¨Ø¹ÙŠØ¯ Ø¹Ù† Ø£ØµØ§Ø¨Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
            this.scoreText = this.add.text(10, 10, `ğŸ† 0 | Lv.1`, { 
                fontSize: '18px', fill: '#fff', fontWeight: 'bold' 
            }).setScrollFactor(0);

            // Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØµØºÙŠØ±Ø© - Ø­Ø¬Ù… Ø£ØµØºØ± (80 Ø¨ÙƒØ³Ù„) ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ©
            this.mmContainer = this.add.container(window.innerWidth - 90, 10).setScrollFactor(0);
            let mmBg = this.add.graphics();
            mmBg.fillStyle(0x000000, 0.4);
            mmBg.fillRoundedRect(0, 0, 80, 80, 10);
            mmBg.lineStyle(1, 0xffffff, 0.5);
            mmBg.strokeRoundedRect(0, 0, 80, 80, 10);
            this.mmContainer.add(mmBg);

            this.mmDot = this.add.graphics();
            this.mmDot.fillStyle(0xff0000, 1);
            this.mmDot.fillCircle(0, 0, 3);
            this.mmContainer.add(this.mmDot);
        }

        updateMiniMap() {
            let mx = (player.x / WORLD_SIZE) * 80;
            let my = (player.y / WORLD_SIZE) * 80;
            this.mmDot.setPosition(mx, my);
        }
    }

    const config = {
        type: Phaser.AUTO,
        width: window.innerWidth,
        height: window.innerHeight,
        physics: { default: 'arcade' },
        scene: MainScene
    };
    new Phaser.Game(config);
</script>
</body>
</html>
