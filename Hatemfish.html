<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>عالم حازم المطور</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #004e7a; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
<script>
    // روابط الصور (شفافة وواضحة)
    const FISH_IMG = 'https://raw.githubusercontent.com/Al-Ameen-Developer/Fish-Assets/main/real_fish_transparent.png';
    const FOOD_IMG = 'https://cdn-icons-png.flaticon.com/512/2271/2271068.png';

    const WORLD_SIZE = 3000; // مساحة العالم

    class GameScene extends Phaser.Scene {
        constructor() { super('GameScene'); }

        preload() {
            this.load.image('player', FISH_IMG);
            this.load.image('food', FOOD_IMG);
        }

        create() {
            // 1. تحديد حدود العالم وخلفية المحيط
            this.cameras.main.setBounds(0, 0, WORLD_SIZE, WORLD_SIZE);
            this.physics.world.setBounds(0, 0, WORLD_SIZE, WORLD_SIZE);
            this.cameras.main.setBackgroundColor('#005c99');

            // 2. إنشاء لاعب (حازم) بحجم واضح
            this.player = this.physics.add.sprite(WORLD_SIZE/2, WORLD_SIZE/2, 'player');
            this.player.setScale(0.3); // كبرت الحجم عشان يبقى واضح
            this.player.setCollideWorldBounds(true);

            // 3. اسم اللاعب فوق السمكة
            this.nameTag = this.add.text(0, 0, 'حازم [Lv.1]', { 
                fontSize: '20px', fill: '#ffffff', backgroundColor: '#00000088', padding: {x:5, y:2} 
            }).setOrigin(0.5, 2.5);

            // 4. الكاميرا تتبع السمكة
            this.cameras.main.startFollow(this.player, true, 0.1, 0.1);

            // 5. توزيع الأكل (السمك الصغير)
            this.foods = this.physics.add.group();
            for (let i = 0; i < 80; i++) {
                this.spawnFood();
            }

            // 6. نظام الأكل والنمو
            this.physics.add.overlap(this.player, this.foods, (p, f) => {
                f.destroy();
                p.setScale(p.scaleX + 0.005); // السمكة تكبر لما تاكل
                this.spawnFood(); // تظهر أكلة تانية في مكان عشوائي
            });

            // 7. الخريطة الصغيرة (Mini-map) في الركن
            this.createMiniMap();
        }

        update() {
            // التحكم باللمس للموبايل
            if (this.input.activePointer.isDown) {
                this.physics.moveToObject(this.player, this.input.activePointer.worldX, this.input.activePointer.worldY, 250);
                let angle = Phaser.Math.Angle.Between(this.player.x, this.player.y, this.input.activePointer.worldX, this.input.activePointer.worldY);
                this.player.setRotation(angle);
            } else {
                this.player.setVelocity(0);
            }

            // تحريك الاسم مع السمكة
            this.nameTag.setPosition(this.player.x, this.player.y);

            // تحديث نقطة الخريطة
            let mx = (this.player.x / WORLD_SIZE) * 100;
            let my = (this.player.y / WORLD_SIZE) * 100;
            this.mapDot.setPosition(mx, my);
        }

        spawnFood() {
            let x = Phaser.Math.Between(100, WORLD_SIZE - 100);
            let y = Phaser.Math.Between(100, WORLD_SIZE - 100);
            let food = this.foods.create(x, y, 'food');
            food.setScale(0.06); // حجم الأكل بقى أوضح
        }

        createMiniMap() {
            // خريطة بسيطة جداً 100x100 بكسل
            this.mapContainer = this.add.container(20, 20).setScrollFactor(0);
            let bg = this.add.graphics();
            bg.fillStyle(0x000000, 0.5);
            bg.fillRect(0, 0, 100, 100);
            bg.lineStyle(2, 0xffffff, 1);
            bg.strokeRect(0, 0, 100, 100);
            this.mapContainer.add(bg);

            this.mapDot = this.add.graphics();
            this.mapDot.fillStyle(0xff0000, 1);
            this.mapDot.fillCircle(0, 0, 4);
            this.mapContainer.add(this.mapDot);
        }
    }

    const config = {
        type: Phaser.AUTO,
        width: window.innerWidth,
        height: window.innerHeight,
        physics: { default: 'arcade' },
        scene: GameScene
    };
    new Phaser.Game(config);
</script>
</body>
</html>
